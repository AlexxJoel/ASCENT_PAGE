---
import { getCollection } from 'astro:content';
import BlogCard from '../../components/BlogCard.astro';
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
    const allPosts = await getCollection('blog');
    const uniqueTags = [...new Set(allPosts.flatMap(post => post.data.tags))];

    return uniqueTags.map(tag => ({
        params: { tag },
        props: { 
            posts: allPosts.filter(post => post.data.tags.includes(tag))
        }
    }));
}

const { tag } = Astro.params;
const { posts } = Astro.props;
---

<BaseLayout 
    title={`Posts tagged with "${tag}"`} 
    description={`All blog posts related to the tag: ${tag}`}
>
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold mb-8">Posts tagged with "{tag}"</h1>
        
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            {posts.filter(Boolean).map(post => (
                <BlogCard post={post} />
            ))}
        </div>
    </div>
</BaseLayout>